{% extends "base.html" %}

{% block title %}Resultado 췅 Eneagrama{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-10">

    <div class="card shadow-lg border-0 p-4 text-center">

      <h2 class="fw-bold">Tus resultados</h2>

      {% if top_types %}
        {% set principal = top_types[0] %}
        {% set txt = eneatipo_textos[principal] %}
      
        <!-- Recuadro: T칤tulo + Descripci칩n -->
        <div class="card border-primary mb-3">
          <div class="card-header bg-primary text-white">
            {{ txt.titulo }}
          </div>
          <div class="card-body">
            <p class="card-text">{{ txt.descripcion }}</p>
          </div>
        </div>
      
        <!-- Recuadro: Caracter칤sticas principales -->
        <div class="card border-secondary mb-3">
          <div class="card-header bg-secondary text-white">
            游리 Caracter칤sticas principales
          </div>
          <div class="card-body">
            <p class="card-text">{{ txt.caracteristicas }}</p>
          </div>
        </div>
      
        <!-- Recuadro: C칩mo puedes sentirte mejor -->
        <div class="card border-success mb-3">
          <div class="card-header bg-success text-white">
            游리 쮺칩mo puedes sentirte mejor?
          </div>
          <div class="card-body">
            <p class="card-text">{{ txt.mejorar }}</p>
          </div>
        </div>
      {% endif %}

      <p class="small text-muted">Total de afirmaciones marcadas: <strong>{{ total_marked }}</strong></p>

      <!-- Gr치fico -->
      <canvas id="eneagramaChart" height="100"></canvas>

      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      <script>
        const ctx = document.getElementById('eneagramaChart').getContext('2d');
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: {{ sorted_porcentajes|map(attribute=0)|list }},
            datasets: [{
              label: '% de respuestas',
              data: {{ sorted_porcentajes|map(attribute=1)|list }},
              backgroundColor: [
                '#4e79a7','#f28e2b','#e15759','#76b7b2','#59a14f',
                '#edc949','#af7aa1','#ff9da7','#9c755f'
              ]
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
                max: 100,
                title: { display: true, text: 'Porcentaje (%)' }
              }
            }
          }
        });
      </script>

      <!-- Lista de resultados -->
      <ul class="list-group mt-4 text-start">
        {% for tipo, score in sorted_scores %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          Tipo {{ tipo }}
          <span class="badge bg-primary rounded-pill">{{ score }}</span>
        </li>
        {% endfor %}
      </ul>

      <div class="mt-4">
        <a href="{{ url_for('reset') }}" class="btn btn-secondary">
          Volver al inicio
        </a>
      </div>

    </div>

  </div>
</div>
{% endblock %}
