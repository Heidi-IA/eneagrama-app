{% extends "base.html" %}

{% block title %}Resultado Â· Eneagrama{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-10">

    <div class="card shadow-lg border-0 p-4 text-center">

      <h2 class="fw-bold">Tus resultados</h2>

      {% if top_types %}
        {% set principal = top_types[0] %}
        {% set txt = eneatipo_textos[principal] %}
      
        <!-- Recuadro: TÃ­tulo + DescripciÃ³n -->
        <div class="card border-primary mb-3">
          <div class="card-header bg-primary text-white">
            {{ txt.titulo }}
          </div>
          <div class="card-body">
            <p class="card-text">{{ txt.descripcion }}</p>
          </div>
        </div>
      
        <!-- Recuadro: CaracterÃ­sticas principales -->
        <div class="card border-secondary mb-3">
          <div class="card-header bg-secondary text-white">
            ðŸŸ¡ CaracterÃ­sticas principales
          </div>
          <div class="card-body">
            <p class="card-text">{{ txt.caracteristicas }}</p>
          </div>
        </div>
      
        <!-- Recuadro: CÃ³mo puedes sentirte mejor -->
        <div class="card border-success mb-3">
          <div class="card-header bg-success text-white">
            ðŸŸ¡ Â¿CÃ³mo puedes sentirte mejor?
          </div>
          <div class="card-body">
            <p class="card-text">{{ txt.mejorar }}</p>
          </div>
        </div>
      {% endif %}

      {% set porcentaje_total = ((total_marked / 270) * 100) | round(1) %}
      
      <div class="mb-3 text-start">
        <p class="fw-semibold">
          Afirmaciones marcadas: <strong>{{ total_marked }}</strong> de 270
          â€” <strong>{{ porcentaje_total }}%</strong>
        </p>
      
        {% if porcentaje_total > 30 %}
          <p class="text-success">
            ðŸ“£ <strong>No tienes problema en mostrarte.</strong>
          </p>
        {% else %}
          <p class="text-warning">
            ðŸ¤« <strong>Eres mÃ¡s bien reservado, te cuesta mostrarte.</strong>
          </p>
        {% endif %}
      </div>


      <!-- GrÃ¡fico -->
      <canvas id="eneagramaChart" height="100"></canvas>

      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      <script>
        const ctx = document.getElementById('eneagramaChart').getContext('2d');
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: {{ sorted_porcentajes|map(attribute=0)|list }},
            datasets: [{
              label: '% de respuestas',
              data: {{ sorted_porcentajes|map(attribute=1)|list }},
              backgroundColor: [
                '#4e79a7','#f28e2b','#e15759','#76b7b2','#59a14f',
                '#edc949','#af7aa1','#ff9da7','#9c755f'
              ]
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
                max: 100,
                title: { display: true, text: 'Porcentaje (%)' }
              }
            }
          }
        });
      </script>

      <!-- Lista de resultados -->
      <ul class="list-group mt-4 text-start">
        {% for tipo, score in sorted_scores %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          Tipo {{ tipo }}
          <span class="badge bg-primary rounded-pill">{{ score }}</span>
        </li>
        {% endfor %}
      </ul>

      <div class="mt-4">
        <a href="{{ url_for('reset') }}" class="btn btn-secondary">
          Volver al inicio
        </a>
      </div>

    </div>

  </div>
</div>
{% endblock %}
