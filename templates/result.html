{% extends "base.html" %}

{% block title %}Resultado ¬∑ Eneagrama{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-10">

    <div class="card shadow-lg border-0 p-4 text-center">

      <h2 class="fw-bold">Tus resultados</h2>

      {% if top_types %}
        {% set principal = top_types[0] %}
        {% set txt = eneatipo_textos[principal] %}
      
        <!-- Recuadro: T√≠tulo + Descripci√≥n -->
        <div class="card border-primary mb-3">
          <div class="card-header bg-primary text-white">
            {{ txt.titulo }}
          </div>
          <div class="card-body">
            <p class="card-text">{{ txt.descripcion }}</p>
          </div>
        </div>

      {% if ala_textos %}
        <div class="card border-info mb-3 text-start">
          <div class="card-header bg-info text-white">
            ü™Ω Tu Ala
          </div>
          <div class="card-body">
            {% for t in ala_textos %}
              <p class="{% if not loop.last %}mb-2{% else %}mb-0{% endif %}">{{ t }}</p>
            {% endfor %}
          </div>
        </div>
      {% endif %}

     
        <!-- Recuadro: Caracter√≠sticas principales -->
        <div class="card border-secondary mb-3">
          <div class="card-header bg-secondary text-white">
            üü° Caracter√≠sticas principales
          </div>
          <div class="card-body">
            <p class="card-text">{{ txt.caracteristicas }}</p>
          </div>
        </div>

        <!-- Recuadro: Orientaci√≥n vocacional -->
        {% if txt.orientacion %}
          <div class="card border-warning mb-3">
            <div class="card-header bg-warning text-dark">
              üéØ Orientaci√≥n vocacional
            </div>
            <div class="card-body">
              <p class="card-text" style="white-space: pre-line;">{{ txt.orientacion }}</p>
            </div>
          </div>
        {% endif %}
      
        <!-- Recuadro: C√≥mo puedes sentirte mejor -->
        <div class="card border-success mb-3">
          <div class="card-header bg-success text-white">
            üü° ¬øC√≥mo puedes sentirte mejor?
          </div>
          <div class="card-body">
            <p class="card-text">{{ txt.mejorar }}</p>
          </div>
        </div>
      {% endif %}

      {% set porcentaje_total = ((total_marked / 270) * 100) | round(1) %}
      
      <div class="mb-3 text-start">
        <p class="fw-semibold">
          Afirmaciones marcadas: <strong>{{ total_marked }}</strong> de 270
          ‚Äî <strong>{{ porcentaje_total }}%</strong>
        </p>
      
        {% if porcentaje_total > 30 %}
          <p class="text-success">
            üì£ <strong>No tienes problema en mostrarte.</strong>
          </p>
        {% else %}
          <p class="text-warning">
            ü§´ <strong>Eres m√°s bien reservado, te cuesta mostrarte.</strong>
          </p>
        {% endif %}
      </div>


      <!-- Gr√°fico -->
      <canvas id="eneagramaChart"></canvas>
      
      <!-- Chart.js -->
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      <!-- Plugin para mostrar labels (%) -->
      <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
      
      <script>
        // Ejemplo: recib√≠s desde Flask labels y values ya como porcentajes
        const labels = {{ labels | tojson }};   // ["1","2","3","4","5","6","7","8","9"]
        const values = {{ values | tojson }};   // [33.3, 11.1, 11.1, 0, 11.1, 11.1, 0, 22.2, 0]
      
        const ctx = document.getElementById('eneagramaChart');
      
        new Chart(ctx, {
          type: 'radar',
          data: {
            labels: labels.map(x => `Tipo ${x}`),
            datasets: [{
              label: '% de respuestas',
              data: values,
              fill: true,
              borderWidth: 2,
              pointRadius: 3
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: true },
              tooltip: {
                callbacks: {
                  label: (context) => `${context.raw.toFixed(1)}%`
                }
              },
              datalabels: {
                formatter: (v) => `${v.toFixed(1)}%`,
                anchor: 'end',
                align: 'end'
              }
            },
            scales: {
              r: {
                suggestedMin: 0,
                suggestedMax: 100,
                ticks: {
                  callback: (v) => `${v}%`
                }
              }
            }
          },
          plugins: [ChartDataLabels]
        });
      </script>


      <div class="card mt-4">
        <div class="card-header fw-bold">
          Esencia ‚Äì Total de afirmaciones
        </div>
        <ul class="list-group list-group-flush text-start">
          {% for tipo, score in sorted_scores %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            Tipo {{ tipo }}
            <span class="badge bg-primary rounded-pill">{{ score }}</span>
          </li>
          {% endfor %}
        </ul>
      </div>

      <div class="card border-warning mt-4 text-start">
        <div class="card-header bg-warning fw-bold">
          Tu camino de evoluci√≥n
        </div>
        <div class="card-body">
          <p class="mb-3">
            Para librarte de las cadenas invisibles que hoy frenan tu desarrollo es recomendable modificar las siguientes creencias limitantes:
          </p>
      
          <ol class="mb-0">
            {% for tipo, pct, texto in camino_evolucion %}
              <li class="mb-2">
                {{ texto }}
              </li>
            {% endfor %}
          </ol>
        </div>
      </div>

      <div class="card border-info mt-4 text-start">
        <div class="card-header bg-info text-white fw-bold">
          An√°lisis de Ejes de Equilibrio
        </div>
        <div class="card-body">
          {% for p in analisis_ejes_parrafos %}
            <p class="{% if not loop.last %}mb-3{% else %}mb-0{% endif %}">{{ p }}</p>
          {% endfor %}
        </div>
      </div>
      
      <div class="card border-dark mt-3 text-start">
        <div class="card-header fw-bold">
          S√≠ntesis Evolutiva
        </div>
        <div class="card-body">
          {% for p in sintesis_parrafos %}
            <p class="{% if not loop.last %}mb-3{% else %}mb-0{% endif %}">{{ p }}</p>
          {% endfor %}
        </div>
      </div>

      <div class="card border-primary mt-4 text-start">
        <div class="card-header bg-primary text-white fw-bold">
          Ejes de Afinidad
        </div>
        <div class="card-body">
          {% for p in afinidades_parrafos %}
            <p class="{% if not loop.last %}mb-3{% else %}mb-0{% endif %}">
              {{ p }}
            </p>
          {% endfor %}
        </div>
      </div>
      
      <div class="card border-secondary mt-3 text-start">
        <div class="card-header fw-bold">
          S√≠ntesis de Afinidades
        </div>
        <div class="card-body">
          {% for p in sintesis_afinidades_parrafos %}
            <p class="{% if not loop.last %}mb-3{% else %}mb-0{% endif %}">
              {{ p }}
            </p>
          {% endfor %}
        </div>
      </div>      

      <!-- Opuestos complementarios -->
      <div class="card border-primary mb-3  text-start">
        <div class="card-header bg-primary text-white">
          ‚öñÔ∏è Opuestos complementarios
        </div>
        <div class="card-body  text-start">
      
          {% for p in opuestos_parrafos %}
            <p class="card-text  text-start">{{ p }}</p>
          {% endfor %}
      
        </div>
      </div>
      
      <!-- S√≠ntesis de Opuestos complementarios -->
      <div class="card border-secondary mb-3  text-start">
        <div class="card-header bg-secondary text-white">
           üß© S√≠ntesis de Opuestos complementarios
        </div>
        <div class="card-body  text-start">
      
          {% for p in opuestos_sintesis %}
            <p class="card-text  text-start">{{ p }}</p>
          {% endfor %}
      
        </div>
      </div>

      <!-- BONUS: üß† Estructura del pensamiento -->
      <div class="card border-secondary mb-3">
        <div class="card-header bg-secondary text-white">
          BONUS: Estructura del pensamiento
        </div>
      
        <div class="card-body text-start">
      
          {% set b = bonus_estructura %}
      
          <h6 class="fw-bold mb-2">{{ b.pensamiento.titulo }}</h6>
          <p class="mb-2">{{ b.pensamiento.parrafo }}</p>
      
          <h6 class="fw-bold mt-3 mb-2">{{ b.inteligencia.titulo }}</h6>
          <p class="mb-2">{{ b.inteligencia.parrafo }}</p>
      
          <h6 class="fw-bold mt-3 mb-2">{{ b.polaridad.titulo }}</h6>
          <p class="mb-2">{{ b.polaridad.parrafo }}</p>
      
          <h6 class="fw-bold mt-3 mb-2">{{ b.triadas.titulo }}</h6>
          <p class="mb-2">{{ b.triadas.parrafo }}</p>
      
          <h6 class="fw-bold mt-3 mb-2">{{ b.expresion.titulo }}</h6>
          <p class="mb-2">{{ b.expresion.parrafo }}</p>
      
          <h6 class="fw-bold mt-3 mb-2">{{ b.vincularidad.titulo }}</h6>
          <p class="mb-2">{{ b.vincularidad.parrafo }}</p>
      
          <h6 class="fw-bold mt-3 mb-2">{{ b.conflictos_internos.titulo }}</h6>
          <p class="mb-2">{{ b.conflictos_internos.parrafo }}</p>
      
          <h6 class="fw-bold mt-3 mb-2">{{ b.reaccion_problemas.titulo }}</h6>
          <p class="mb-2">{{ b.reaccion_problemas.parrafo }}</p>
      
          <hr class="my-3">
      
          <h6 class="fw-bold mb-2">S√≠ntesis</h6>
          {% for p in b.sintesis %}
            <p class="mb-2">{{ p }}</p>
          {% endfor %}
      
        </div>
      </div>

     
      <div class="mt-4">
        <a href="{{ url_for('reset') }}" class="btn btn-secondary">
          Volver al inicio
        </a>
      </div>
     
    </div>

  </div>
</div>
{% endblock %}

